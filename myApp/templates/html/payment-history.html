{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="Dashboard">
    <meta name="keyword" content="Dashboard, Bootstrap, Admin, Template, Theme, Responsive, Fluid, Retina">
    <title>Ginatilan Billing System</title>

    <!-- Favicons -->
    <link href="{% static 'website/img/favicon.ico' %}" rel="icon">
    <link href="{% static 'website/img/apple-touch-icon.ico' %}" rel="apple-touch-icon">

    <!-- Bootstrap core CSS -->
    <link href="{% static 'website/lib/bootstrap/css/bootstrap.min.css' %}" rel="stylesheet">
    <!--external css-->
    <link href="{% static 'website/lib/font-awesome/css/font-awesome.css' %}" rel="stylesheet" />
    <link rel="stylesheet" type="text/css" href="{% static '/website/css/zabuto_calendar.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static '/website/lib/gritter/css/jquery.gritter.css' %}" />
    <!-- Custom styles for this template -->
    <link href="{% static 'website/css/styles.css' %}" rel="stylesheet">
    <link href="{% static 'custom.css' %}" rel="stylesheet">
    <link href="{% static '/website/css/font.css' %}" rel="stylesheet">
    <link href="{% static 'website/css/style-responsive.css' %}" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'website/lib/bootstrap/css/bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'website/lib/DataTables/css/mdb.min.css' %}">
    <link rel="stylesheet" href="{% static 'website/lib/bootstrap/css/ModifiedBootstrap.css' %}">
    <link rel="stylesheet" href="{% static 'website/lib/DataTables/css/dataTables.bootstrap4.min.css' %}">
    <script src="{% static 'website/lib/jquery/jquery.min.js' %}"></script>
    <script src="{% static 'website/lib/DataTables/js/popper.min.js' %}"></script>
    <script src="{% static 'website/lib/bootstrap/js/bootstrap.min.js' %}"></script>
    <script src="{% static 'website/lib/DataTables/js/mdb.min.js' %}"></script>
    <script src="{% static 'website/lib/jsPDF/jspdf.min.js' %}"></script>
    <script src="{% static 'website/lib/jsPDF/jspdf-autotable.js' %}"></script>

</head>
<style>

</style>

<body>

    </div>
    <section id="container">
        <!--Header Start-->
        <header class="header black-bg">
            <div class="sidebar-toggle-box">
                <div class="fa fa-bars tooltips" data-placement="right" data-original-title="Toggle Navigation"></div>
            </div>
            <!--logo start-->
            <a href="index.html" class="logo"><b>Ginatilan Water Billing<span> Station</span></b></a>
            <!--logo end-->
            <div class="top-menu">
                <ul class="nav pull-right top-menu">
                    <li><a class="logout" href="/logout">Logout</a></li>
                </ul>
            </div>
        </header>
        <!--Header End-->
        <!--sidebar start-->
        <aside>
            <form action="/source_access/payment-history={{account.accountinfoid}}" method="POST">
                <div id="sidebar" class="nav-collapse ">
                    <!-- sidebar menu start-->
                    <ul class="sidebar-menu" id="nav-accordion">
                        <p class="centered"><a href=""><img src="{% static 'website/img/ui-admin.jpg' %}"
                                    class="img-circle" width="80"></a></p>
                        <h5 class="centered">{{ context.name }}</h5>



                        <div id="input_reading" class="active">
                            <li class="sub-menu">
                                <a href="/source_access/Payment={{account.accountinfoid}}" class="active">
                                    <i class="fa fa-arrow-left"></i>
                                    <span>Back</span>
                                </a>
                        </div>





        </aside>
        <br>
        <br>
        <br>
        <br>
        <br>
        <br>
        <br>
        <br>
        <br>
        <!--sidebar end-->
        <!--main content start-->
        <section id="main-content">
            <div class="container">
                <div class="card1">
                    <section class="wrapper">
                        <!-- DATA Section -->

                        {% csrf_token %}
                        <br>
                        <script>

                            const formatter = new Intl.NumberFormat('en-US', {
                                style: 'currency',
                                currency: 'Php',
                                minimumFractionDigits: 2
                            })


                        </script>
                        <script>
                            function this_record() {
                                var doc = new jsPDF('p', 'pt', 'letter');
                                var htmlstring = '';
                                var tempVarToCheckPageHeight = 0;
                                var pageHeight = 0;

                                pageHeight = doc.internal.pageSize.height;
                                specialElementHandlers = {
                                    // element with id of "bypass" - jQuery style selector
                                    '#bypassme': function (element, renderer) {
                                        // true = "handled elsewhere, bypass text extraction"
                                        return true
                                    }
                                };
                                margins = {
                                    top: 150,
                                    bottom: 60,
                                    left: 40,
                                    right: 40,
                                    width: 600
                                };
                                const formatter = new Intl.NumberFormat('en-US', {
                                    style: 'currency',
                                    currency: 'Php',
                                    minimumFractionDigits: 2
                                })

                                var y = 20;
                                var x = 40;
                                doc.setLineWidth(2);
                                doc.setFontSize(11);
                                doc.autoTable({
                                    html: '#doc_header',
                                    startY: y = y + 20,
                                    theme: 'plain',
                                })
                                doc.setLineWidth(2);
                                doc.setFontSize(14);
                                doc.text(250, y = y + 80, "Payment History");


                                doc.autoTable({
                                    html: '.this_table',
                                    startY: y = y + 20,
                                    theme: 'striped',
                                    columnStyles: {
                                        0: {
                                            cellWidth: 130,
                                        },
                                        1: {
                                            cellWidth: 130,
                                        },
                                        2: {
                                            cellWidth: 130,
                                        },
                                        3: {
                                            cellWidth: 135,
                                        }
                                    },
                                    styles: {
                                        minCellHeight: 20
                                    }
                                })
                                doc.save('{{account.firstname}}_{{account.lastname}}_Payment_History.pdf');
                            }

                            function CurrencyConverter(amount) {
                                var formatter = new Intl.NumberFormat('en-US', {
                                    style: 'currency',
                                    currency: 'Php',

                                });
                                return formatter.format(amount);
                            }

                        </script>

                        <div class="loader-wrapper">
                            <span class="loader">
                                <img src="{% static '/website/img/loading.gif' %}">
                            </span>
                        </div>
                        <center>Consumer's Information</center>
                        <br>
                        <div class="table-responsive">
                            <table id="doc_header" class="table table-bordered" style="width:100%">
                                <thead>
                                    <tr>
                                        <th scope="col">Account ID</th>
                                        <th scope="col">Meter Number</th>
                                        <th scope="col">Name</th>
                                        <th scope="col">Address</th>

                                    </tr>
                                    <i></i>
                                </thead>

                                <tbody>

                                    <tr>

                                        <th scope="row">{{ account.accountinfoid }}</th>
                                        <th scope="row">{{ account.meternumber }}</th>
                                        <td>{{ account.firstname }} {{ account.middlename }}. {{ account.lastname }}
                                        </td>
                                        <td>{{ account.address }}</td>

                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <br>
                        <br>
                        <center>Payment History </center>

                        <br>
                        <div class="row">
                            <div class="col-sm">
                                <div class="form-group">
                                    <label for="exampleInputBarangay">Select Year</label>
                                    <select name="{{ ReqParams.year }}" class="form-control"
                                        onchange='this.form.submit();'>
                                        <option value="{{defval}}" selected>{{defval}}</option>
                                        {% for year in year_list %}
                                        <option value="{{ year }}">{{year}}</option>
                                        {%endfor%}
                                    </select>
                                </div>
                                <noscript><input type="submit" value="Submit"></noscript>
                            </div>
                            <div class="col-sm">
                                <div class="form-group">
                                    <br>

                                    <button type="button" id="postbtn" class="btn btn-primary"
                                        onclick="this_record()">Get a Copy</button>
                                </div>

                            </div>
                            <div class="col-sm">
                                <div class="form-group"></div>
                            </div>

                            <div class="col-sm">
                                <div class="form-group"></div>
                            </div>
                        </div>

                        <br>

                        <div class="table-responsive">
                            <table id="tablePagination" class="table table-bordered" style="width:100%">
                                <thead>
                                    <tr>
                                        <th scope="col">Amount Paid</th>
                                        <th scope="col">Date</th>
                                        <th scope="col">OR Number</th>
                                        <th scope="col">Posted By</th>

                                    </tr>
                                </thead>
                                <tbody>
                                    {% for element in retval %}
                                    <tr>

                                        <th scope="row">
                                            <script>document.write(CurrencyConverter("{{ element.amount }}"))</script>
                                        </th>
                                        <td>{{ element.date }}</td>
                                        <td>{{ element.or_number }}</td>
                                        <td>{{ element.processedby }}</td>
                                    </tr>
                                    {%endfor %}
                                </tbody>
                            </table>
                        </div>

                        <div class="table-responsive" hidden>
                            <table id="tablePagination" class="table table-bordered this_table" style="width:100%">
                                <thead>
                                    <tr>
                                        <th scope="col">Amount Paid</th>
                                        <th scope="col">Date</th>
                                        <th scope="col">OR Number</th>
                                        <th scope="col">Posted By</th>

                                    </tr>
                                </thead>
                                <tbody>
                                    {% for element in accountrecord %}
                                    <tr>
                                        <th scope="row">{{ element.amount|floatformat:2 }}</th>
                                        <td>{{ element.date }}</td>
                                        <td>{{ element.or_number }}</td>
                                        <td>{{ element.postedby }}</td>
                                    </tr>
                                    {%endfor %}
                                </tbody>
                            </table>
                        </div>

                        <br>
                        <br>

                        </form>
                    </section>
        </section>
        </div>
        </div>


        <!--main content end-->
    </section>
    <!-- js placed at the end of the document so the pages load faster -->
    <script src="{% static 'website/lib/jquery/jquery.min.js' %}"></script>

    <script src="{% static 'website/lib/bootstrap/js/bootstrap.min.js' %}"></script>
    <script class="include" type="text/javascript"
        src="{% static 'website/lib/jquery.dcjqaccordion.2.7.js' %} "></script>
    <script src="{% static 'website/lib/jquery.scrollTo.min.js' %}"></script>
    <script src="{% static 'website/lib/jquery.nicescroll.js' %}" type="text/javascript"></script>
    <script src="{% static 'website/lib/jquery.sparkline.js' %}"></script>
    <script src="{% static 'website/lib/common-scripts.js' %}"></script>
    <script type="text/javascript" src="{% static 'website/lib/gritter/js/jquery.gritter.js' %}"></script>
    <script type="text/javascript" src="{% static 'website/lib/gritter-conf.js' %}"></script>
    <script src="{% static 'website/lib/DataTables/js/jquery.dataTables.min.js' %}"></script>
    <script src="{% static 'website/lib/DataTables/js/dataTables.bootstrap4.min.js' %}"></script>

    <script>
        $(document).ready(function () {
            $('#tablePagination').DataTable({
                "lengthChange": false,
                "ordering": false,
                "searching": false,
                "paging": false,
                "info": false,
            });
        });

        $(window).on("load", function () {
            $(".loader-wrapper").fadeOut("milliseconds");
        });
    </script>
</body>

</html>